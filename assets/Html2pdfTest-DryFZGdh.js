import{a as m}from"./axios-CCb-kr4I.js";import{_ as G,l as n,m as Q,c as g,a as s,b as l,g as _,u as r,o as x,p as v,i as C,q as j,D as k,t as i,ac as K,ad as J,e as O,B as z}from"./index-DkiEf_42.js";import{s as q}from"./index-CRviYiyA.js";import{h as W}from"./html2pdf-Ej1PnI55.js";import"./_commonjsHelpers-BosuxZz1.js";const X={class:"table-container"},Y={style:{width:"100%","border-collapse":"collapse","text-align":"center"}},Z={style:{border:"1px solid #000"}},ee={style:{border:"1px solid #000"}},te={style:{border:"1px solid #000"}},se={style:{border:"1px solid #000"}},ae={style:{border:"1px solid #000"}},le={style:{"margin-top":"1rem"}},re={__name:"Html2pdfTest",setup(oe){const S=n([]),$=n(!1),h=n(!1),d=n(null),P=n(0),c=n(null),b=n(null),D=n([]),I=n([{label:"A4",value:"a4"},{label:"A5",value:"a5"},{label:"80 mm",value:[80,230]},{label:"72 mm",value:[72,230]},{label:"58 mm",value:[58,230]}]),N=n({}),A=async()=>{try{const t=await m.get("sbs-api/sales");t.data.success==="true"?S.value=t.data.result||[]:console.error("Error fetching sales data:",t.data.message)}catch(t){console.error("Error fetching sales data:",t)}},B=async()=>{try{const t=await m.get("sbs-api/sales/preferences");t.data.success==="true"?D.value=t.data.result||[]:console.error("Error fetching clients:",t.data.message)}catch(t){console.error("Error fetching clients:",t)}},F=async()=>{if(b.value)try{const t=await m.get(`sbs-api/sales/preferences/${b.value}`);t.data.success==="true"?N.value=t.data.result:console.error("Error fetching client preferences:",t.data.message)}catch(t){console.error("Error fetching client preferences:",t)}},L=async t=>{const a=t.id,e=await m.get(`sbs-api/sales/details/${a}`);e.data.success==="true"?(d.value={...t,items:e.data.result},P.value=d.value.items.reduce((u,f)=>u+(f.rate-f.discount)*f.quantity,0),$.value=!0):console.error("Error fetching sales details:",e.data.message)},M=()=>{h.value=!0},R=()=>{h.value=!1,U(d.value)},U=async t=>{const a=t.id;try{const e=await m.get(`sbs-api/sales/details/${a}`),u=await m.get(`sbs-api/sales/preferences/${b.value}`);if(e.data.success==="true"&&u.data.success==="true"){const f=e.data.result,p=u.data.result;if(!p){console.error("Preferences not found for the given client");return}let w=`
        <div style="text-align: ${p.company_name_align};">
          <h2>Sales Invoice</h2>
          <p><strong>${p.client_name}</strong></p>
          <p>Kathmandu, Nepal</p>
          <p><strong>Customer Name: ${t.customerName}</strong></p>
          <p style="text-align: ${p.date_align};"><strong>Date: ${t.date}</strong></p>
          <table style="width: 100%; border-collapse: collapse; text-align: ${p.table_align};">
            <thead>
              <tr>
                <th style="border: 1px solid #000;">Product Name</th>
                <th style="border: 1px solid #000;">Rate</th>
                <th style="border: 1px solid #000;">Quantity</th>
                <th style="border: 1px solid #000;">Discount</th>
                <th style="border: 1px solid #000;">Total</th>
              </tr>
            </thead>
            <tbody>
      `,E=0;f.forEach(o=>{const T=(o.rate-o.discount)*o.quantity;E+=T,w+=`
          <tr>
            <td style="border: 1px solid #000;">${o.productName}</td>
            <td style="border: 1px solid #000;">${o.rate}</td>
            <td style="border: 1px solid #000;">${o.quantity}</td>
            <td style="border: 1px solid #000;">${o.discount}</td>
            <td style="border: 1px solid #000;">${T}</td>
          </tr>
        `}),w+=`
            </tbody>
          </table>
          <h3 style="text-align: ${p.grand_total_align};">Grand Total: ${E}</h3>
        </div>
      `;const y=document.createElement("div");y.innerHTML=w,document.body.appendChild(y);let V=2;(c.value==="58mm"||c.value==="72mm"||c.value==="80mm")&&(V=4);const H={margin:.5,filename:`SalesDetail_${a}.pdf`,html2canvas:{scale:V},jsPDF:{unit:"mm",format:c.value,orientation:"portrait"}};W().from(y).set(H).toPdf().get("pdf").then(function(o){window.open(o.output("bloburl"),"_blank"),o.autoPrint()}).catch(o=>{console.error("Error generating PDF:",o)}),document.body.removeChild(y)}else console.error("Error fetching sales details or preferences:",e.data.message,u.data.message)}catch(e){console.error("Error during print preview:",e)}};return Q(()=>{A(),B()}),(t,a)=>(x(),g("div",X,[a[6]||(a[6]=s("h2",null,"Sales Details",-1)),l(r(j),{value:S.value,tableStyle:"min-width: 50rem"},{default:_(()=>[l(r(v),{field:"date",header:"Date"}),l(r(v),{field:"total",header:"Total"}),l(r(v),{field:"customerName",header:"Customer Name"}),l(r(v),{field:"paymentMode",header:"Payment Mode"}),l(r(v),{header:"Actions"},{body:_(e=>[l(r(C),{label:"View Details",onClick:u=>L(e.data)},null,8,["onClick"])]),_:1})]),_:1},8,["value"]),l(r(q),{visible:$.value,"onUpdate:visible":a[0]||(a[0]=e=>$.value=e),header:"Sales Details",modal:!0,closable:!0,style:{width:"50vw"}},{default:_(()=>[d.value?(x(),g(k,{key:0},[s("h3",{style:K({textAlign:N.value.customer_name_align})},"Customer Name: "+i(d.value.customerName),5),s("table",Y,[a[4]||(a[4]=s("thead",null,[s("tr",null,[s("th",{style:{border:"1px solid #000"}},"Product Name"),s("th",{style:{border:"1px solid #000"}},"Rate"),s("th",{style:{border:"1px solid #000"}},"Quantity"),s("th",{style:{border:"1px solid #000"}},"Discount"),s("th",{style:{border:"1px solid #000"}},"Total")])],-1)),s("tbody",null,[(x(!0),g(k,null,J(d.value.items,e=>(x(),g("tr",{key:e.productName},[s("td",Z,i(e.productName),1),s("td",ee,i(e.rate),1),s("td",te,i(e.quantity),1),s("td",se,i(e.discount),1),s("td",ae,i((e.rate-e.discount)*e.quantity),1)]))),128))])]),s("h3",null,"Grand Total: "+i(P.value),1),l(r(C),{label:"Print",onClick:M})],64)):O("",!0)]),_:1},8,["visible"]),l(r(q),{visible:h.value,"onUpdate:visible":a[3]||(a[3]=e=>h.value=e),header:"Select Client and Paper Size",modal:!0,closable:!0,style:{width:"30vw"}},{default:_(()=>[s("div",null,[a[5]||(a[5]=s("p",null,"Select the client and paper size for the PDF:",-1)),l(r(z),{modelValue:b.value,"onUpdate:modelValue":a[1]||(a[1]=e=>b.value=e),options:D.value,optionLabel:"client_name",optionValue:"client_id",placeholder:"Select Client",onChange:F},null,8,["modelValue","options"]),l(r(z),{modelValue:c.value,"onUpdate:modelValue":a[2]||(a[2]=e=>c.value=e),options:I.value,optionLabel:"label",optionValue:"value",placeholder:"Select Paper Size"},null,8,["modelValue","options"]),s("div",le,[l(r(C),{label:"Confirm",onClick:R})])])]),_:1},8,["visible"])]))}},pe=G(re,[["__scopeId","data-v-6d63a20f"]]);export{pe as default};
