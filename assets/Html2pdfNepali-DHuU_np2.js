import{a as m}from"./axios-CCb-kr4I.js";import{_ as Q,l as n,m as j,c as g,a as s,b as a,g as _,u as o,o as x,p as f,i as D,q as G,D as q,t as i,ac as K,ad as J,e as O,B as T}from"./index-DkiEf_42.js";import{s as z}from"./index-CRviYiyA.js";import{h as W}from"./html2pdf-Ej1PnI55.js";import"./_commonjsHelpers-BosuxZz1.js";const X={class:"table-container"},Y={style:{width:"100%","border-collapse":"collapse","text-align":"center"}},Z={style:{border:"1px solid #000"}},ee={style:{border:"1px solid #000"}},te={style:{border:"1px solid #000"}},se={style:{border:"1px solid #000"}},le={style:{border:"1px solid #000"}},ae={style:{"margin-top":"1rem"}},oe={__name:"Html2pdfNepali",setup(re){const C=n([]),$=n(!1),h=n(!1),d=n(null),E=n(0),c=n(null),b=n(null),N=n([]),I=n([{label:"A4",value:"a4"},{label:"A5",value:"a5"},{label:"80 mm",value:[80,230]},{label:"72 mm",value:[72,230]},{label:"58 mm",value:[58,230]}]),V=n({}),B=async()=>{try{const t=await m.get("sbs-api/sales");t.data.success==="true"?C.value=t.data.result||[]:console.error("Error fetching sales data:",t.data.message)}catch(t){console.error("Error fetching sales data:",t)}},F=async()=>{try{const t=await m.get("sbs-api/sales/preferences");t.data.success==="true"?N.value=t.data.result||[]:console.error("Error fetching clients:",t.data.message)}catch(t){console.error("Error fetching clients:",t)}},L=async()=>{if(b.value)try{const t=await m.get(`sbs-api/sales/preferences/${b.value}`);t.data.success==="true"?V.value=t.data.result:console.error("Error fetching client preferences:",t.data.message)}catch(t){console.error("Error fetching client preferences:",t)}},R=async t=>{const l=t.id,e=await m.get(`sbs-api/sales/details/${l}`);e.data.success==="true"?(d.value={...t,items:e.data.result},E.value=d.value.items.reduce((u,v)=>u+(v.rate-v.discount)*v.quantity,0),$.value=!0):console.error("Error fetching sales details:",e.data.message)},U=()=>{h.value=!0},A=()=>{h.value=!1,H(d.value)},H=async t=>{const l=t.id;try{const e=await m.get(`sbs-api/sales/details/${l}`),u=await m.get(`sbs-api/sales/preferences/${b.value}`);if(e.data.success==="true"&&u.data.success==="true"){const v=e.data.result,p=u.data.result;if(!p){console.error("Preferences not found for the given client");return}let w=`
        <div style="text-align: ${p.company_name_align};">
          <h2>Sales Invoice</h2>
          <p><strong>${p.client_name}</strong></p>
          <p>Kathmandu, Nepal</p>
          <p><strong>Customer Name: ${t.customerName}</strong></p>
          <p style="text-align: ${p.date_align};"><strong>Date: ${t.date}</strong></p>
          <table style="width: 100%; border-collapse: collapse; text-align: ${p.table_align};">
            <thead>
              <tr>
                <th style="border: 1px solid #000;">Product Name</th>
                <th style="border: 1px solid #000;">Rate</th>
                <th style="border: 1px solid #000;">Quantity</th>
                <th style="border: 1px solid #000;">Discount</th>
                <th style="border: 1px solid #000;">Total</th>
              </tr>
            </thead>
            <tbody>
      `,P=0;v.forEach(r=>{const k=(r.rate-r.discount)*r.quantity;P+=k,w+=`
          <tr>
            <td style="border: 1px solid #000;">${r.productName}</td>
            <td style="border: 1px solid #000;">${r.rate}</td>
            <td style="border: 1px solid #000;">${r.quantity}</td>
            <td style="border: 1px solid #000;">${r.discount}</td>
            <td style="border: 1px solid #000;">${k}</td>
          </tr>
        `}),w+=`
            </tbody>
          </table>
          <h3 style="text-align: ${p.grand_total_align};">Grand Total: ${P}</h3>
        </div>
      `;const y=document.createElement("div");y.innerHTML=w,document.body.appendChild(y);let S=2;(c.value==="58mm"||c.value==="72mm"||c.value==="80mm")&&(S=4);const M={margin:.5,filename:`SalesDetail_${l}.pdf`,html2canvas:{scale:S},jsPDF:{unit:"mm",format:c.value,orientation:"portrait"}};W().from(y).set(M).toPdf().get("pdf").then(function(r){window.open(r.output("bloburl"),"_blank"),r.autoPrint()}).catch(r=>{console.error("Error generating PDF:",r)}),document.body.removeChild(y)}else console.error("Error fetching sales details or preferences:",e.data.message,u.data.message)}catch(e){console.error("Error during print preview:",e)}};return j(()=>{B(),F()}),(t,l)=>(x(),g("div",X,[l[6]||(l[6]=s("h2",null,"Sales Details",-1)),a(o(G),{value:C.value,tableStyle:"min-width: 50rem"},{default:_(()=>[a(o(f),{field:"date",header:"मिति"}),a(o(f),{field:"total",header:"उप कुल रकम"}),a(o(f),{field:"customerName",header:"ग्राहकको नाम"}),a(o(f),{field:"paymentMode",header:"भुक्तानी मोड"}),a(o(f),{header:"कार्यहरू"},{body:_(e=>[a(o(D),{label:"View Details",onClick:u=>R(e.data)},null,8,["onClick"])]),_:1})]),_:1},8,["value"]),a(o(z),{visible:$.value,"onUpdate:visible":l[0]||(l[0]=e=>$.value=e),header:"Sales Details",modal:!0,closable:!0,style:{width:"50vw"}},{default:_(()=>[d.value?(x(),g(q,{key:0},[s("h3",{style:K({textAlign:V.value.customer_name_align})},"ग्राहकको नाम "+i(d.value.customerName),5),s("table",Y,[l[4]||(l[4]=s("thead",null,[s("tr",null,[s("th",{style:{border:"1px solid #000"}},"वस्तुको नाम"),s("th",{style:{border:"1px solid #000"}},"Rate"),s("th",{style:{border:"1px solid #000"}},"Quantity"),s("th",{style:{border:"1px solid #000"}},"Discount"),s("th",{style:{border:"1px solid #000"}},"Total")])],-1)),s("tbody",null,[(x(!0),g(q,null,J(d.value.items,e=>(x(),g("tr",{key:e.productName},[s("td",Z,i(e.productName),1),s("td",ee,i(e.rate),1),s("td",te,i(e.quantity),1),s("td",se,i(e.discount),1),s("td",le,i((e.rate-e.discount)*e.quantity),1)]))),128))])]),s("h3",null,"कुल रकम: "+i(E.value),1),a(o(D),{label:"छाप्नुहोस्",onClick:U})],64)):O("",!0)]),_:1},8,["visible"]),a(o(z),{visible:h.value,"onUpdate:visible":l[3]||(l[3]=e=>h.value=e),header:"ग्राहक र कागज आकार चयन गर्नुहोस्",modal:!0,closable:!0,style:{width:"30vw"}},{default:_(()=>[s("div",null,[l[5]||(l[5]=s("p",null,"PDF को लागि ग्राहक र कागज आकार चयन गर्नुहोस्:",-1)),a(o(T),{modelValue:b.value,"onUpdate:modelValue":l[1]||(l[1]=e=>b.value=e),options:N.value,optionLabel:"client_name",optionValue:"client_id",placeholder:"ग्राहक चयन गर्नुहोस्:",onChange:L},null,8,["modelValue","options"]),a(o(T),{modelValue:c.value,"onUpdate:modelValue":l[2]||(l[2]=e=>c.value=e),options:I.value,optionLabel:"label",optionValue:"value",placeholder:"कागज आकार चयन गर्नुहोस्:"},null,8,["modelValue","options"]),s("div",ae,[a(o(D),{label:"पुष्टि गर्नुहोस्",onClick:A})])])]),_:1},8,["visible"])]))}},pe=Q(oe,[["__scopeId","data-v-375a9699"]]);export{pe as default};
